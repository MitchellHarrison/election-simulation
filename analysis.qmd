```{r}
#| label: import-libs
library(tidyverse)
library(RSQLite)
```

```{r}
#| label: read-data
db <- dbConnect(SQLite(), dbname = "simulation.db")
query <- "SELECT * FROM sim;"
agent_df <- dbGetQuery(db, query)
dbDisconnect(db)

agents <- as_tibble(agent_df)
```

```{r}
agents |>
  filter(model_iteration %% 4 == 0) |>
  group_by(model_iteration) |>
  summarise(number_of_people = n())
```

```{r}
#| label: age-histogram
agents |>
  ggplot(aes(x = age)) +
  geom_histogram(color = "black", fill = "red", alpha = 0.5) +
  labs(
    x = "Age",
    y = "Count",
    title = "Age Distribution of Simulation Agents"
  ) +
  theme_test()
```

```{r}
#| label: race-counts
agents |>
  filter(model_iteration == 0) |>
  group_by(race) |>
  summarise(n = n()) |>
  arrange(desc(n)) |>
  mutate(race = factor(race, levels = race)) |>
  ggplot(aes(x = race, y = n)) +
  geom_col(color = "black", fill = "red", alpha = 0.5) +
  labs(
    x = element_blank(),
    y = "Count",
    title = "Racial Makeup of Simulation Agents"
  ) +
  theme_test()
```

```{r}
agents |>
  filter(agent_id == 3) |>
  ggplot(aes(x = model_iteration, y = politics_score)) +
  geom_line()
```

